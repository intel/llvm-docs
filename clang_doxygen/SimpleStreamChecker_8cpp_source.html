<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>clang: lib/StaticAnalyzer/Checkers/SimpleStreamChecker.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">clang
   &#160;<span id="projectnumber">15.0.0git</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li><li class="navelem"><a class="el" href="dir_5323669f7aaa7f9ff43db9a3c9e1bf2d.html">StaticAnalyzer</a></li><li class="navelem"><a class="el" href="dir_98a0d9a5a3820cce728a787f3e823141.html">Checkers</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">SimpleStreamChecker.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="SimpleStreamChecker_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//===-- SimpleStreamChecker.cpp -----------------------------------------*- C++ -*--//</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">// See https://llvm.org/LICENSE.txt for license information.</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// Defines a checker for proper use of fopen/fclose APIs.</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">//   - If a file has been closed with fclose, it should not be accessed again.</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">//   Accessing a closed file results in undefined behavior.</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">//   - If a file was opened with fopen, it must be closed with fclose before</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">//   the execution ends. Failing to do so results in a resource leak.</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160; </div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="BuiltinCheckerRegistration_8h.html">clang/StaticAnalyzer/Checkers/BuiltinCheckerRegistration.h</a>&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="BugType_8h.html">clang/StaticAnalyzer/Core/BugReporter/BugType.h</a>&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Checker_8h.html">clang/StaticAnalyzer/Core/Checker.h</a>&quot;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CallDescription_8h.html">clang/StaticAnalyzer/Core/PathSensitive/CallDescription.h</a>&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CallEvent_8h.html">clang/StaticAnalyzer/Core/PathSensitive/CallEvent.h</a>&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CheckerContext_8h.html">clang/StaticAnalyzer/Core/PathSensitive/CheckerContext.h</a>&quot;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &lt;utility&gt;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160; </div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespaceclang.html">clang</a>;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="keyword">using namespace </span>ento;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160; </div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="keyword">namespace </span>{</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="keyword">typedef</span> <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;SymbolRef, 2&gt;</a> SymbolVector;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160; </div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="keyword">struct </span>StreamState {</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="keyword">private</span>:</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  <span class="keyword">enum</span> <a class="code" href="namespaceclang_1_1ObjCPropertyAttribute.html#a5cee046f95725089d626e8e3c42bf60c">Kind</a> { Opened, <a class="code" href="namespaceclang_1_1api__notes.html#a9b6b1e81948c2ed6b68a07a017c07673a03f4a47830f97377a35321051685071e">Closed</a> } K;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  StreamState(<a class="code" href="namespaceclang_1_1ObjCPropertyAttribute.html#a5cee046f95725089d626e8e3c42bf60c">Kind</a> InK) : K(InK) { }</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160; </div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  <span class="keywordtype">bool</span> isOpened()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> K == Opened; }</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <span class="keywordtype">bool</span> isClosed()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> K == <a class="code" href="namespaceclang_1_1api__notes.html#a9b6b1e81948c2ed6b68a07a017c07673a03f4a47830f97377a35321051685071e">Closed</a>; }</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160; </div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <span class="keyword">static</span> StreamState getOpened() { <span class="keywordflow">return</span> StreamState(Opened); }</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <span class="keyword">static</span> StreamState getClosed() { <span class="keywordflow">return</span> StreamState(Closed); }</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160; </div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="namespaceclang.html#a4a57f21b55a81cefae4379e09a3be0c3">operator==</a>(<span class="keyword">const</span> StreamState &amp;<a class="code" href="namespaceclang_1_1tooling.html#a4ffee664435dba78b2225a5457619b53">X</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="keywordflow">return</span> K == <a class="code" href="namespaceclang_1_1tooling.html#a4ffee664435dba78b2225a5457619b53">X</a>.K;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  }</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  <span class="keywordtype">void</span> Profile(llvm::FoldingSetNodeID &amp;<a class="code" href="namespaceclang_1_1Builtin.html#a96281da348e2b70f3a45a66f6e48905c">ID</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <a class="code" href="namespaceclang_1_1Builtin.html#a96281da348e2b70f3a45a66f6e48905c">ID</a>.AddInteger(K);</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  }</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;};</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160; </div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="keyword">class </span>SimpleStreamChecker : <span class="keyword">public</span> Checker&lt;check::PostCall,</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;                                           check::PreCall,</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;                                           check::DeadSymbols,</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;                                           check::PointerEscape&gt; {</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  CallDescription OpenFn, CloseFn;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160; </div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  std::unique_ptr&lt;BugType&gt; DoubleCloseBugType;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  std::unique_ptr&lt;BugType&gt; LeakBugType;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160; </div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <span class="keywordtype">void</span> reportDoubleClose(<a class="code" href="namespaceclang_1_1ento.html#a7b23a067324d14c5d493837dbc4fd8ca">SymbolRef</a> FileDescSym,</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;                         <span class="keyword">const</span> CallEvent &amp;Call,</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;                         CheckerContext &amp;C) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160; </div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <span class="keywordtype">void</span> reportLeaks(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;SymbolRef&gt;</a> LeakedStreams, CheckerContext &amp;C,</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;                   ExplodedNode *ErrNode) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160; </div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="keywordtype">bool</span> guaranteedNotToCloseFile(<span class="keyword">const</span> CallEvent &amp;Call) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160; </div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  SimpleStreamChecker();</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">  /// Process fopen.</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> checkPostCall(<span class="keyword">const</span> CallEvent &amp;Call, CheckerContext &amp;C) <span class="keyword">const</span>;<span class="comment"></span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">  /// Process fclose.</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> checkPreCall(<span class="keyword">const</span> CallEvent &amp;Call, CheckerContext &amp;C) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160; </div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <span class="keywordtype">void</span> checkDeadSymbols(SymbolReaper &amp;SymReaper, CheckerContext &amp;C) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">  /// Stop tracking addresses which escape.</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment"></span>  <a class="code" href="namespaceclang_1_1ento.html#a4e45a121820f0d80d8910093dd33a1df">ProgramStateRef</a> checkPointerEscape(<a class="code" href="namespaceclang_1_1ento.html#a4e45a121820f0d80d8910093dd33a1df">ProgramStateRef</a> <a class="code" href="UnwrappedLineFormatter_8cpp.html#a83e9e4ff6cb05dbdf72ab2a01aa289c0">State</a>,</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                                    <span class="keyword">const</span> <a class="code" href="namespaceclang_1_1ento.html#ab2743eb22efec4f33d5138cfb12366d6">InvalidatedSymbols</a> &amp;Escaped,</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;                                    <span class="keyword">const</span> CallEvent *Call,</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                                    <a class="code" href="namespaceclang_1_1ento.html#a1f45158b71c9d04bfd6094ee29a38e59">PointerEscapeKind</a> <a class="code" href="namespaceclang_1_1ObjCPropertyAttribute.html#a5cee046f95725089d626e8e3c42bf60c">Kind</a>) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;};</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160; </div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;} <span class="comment">// end anonymous namespace</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">/// The state of the checker is a map from tracked stream symbols to their</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">/// state. Let&#39;s store it in the ProgramState.</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment"></span><a class="code" href="ProgramStateTrait_8h.html#a6d1893bb8c18543337b6c363c1319fcf">REGISTER_MAP_WITH_PROGRAMSTATE</a>(StreamMap, <a class="code" href="namespaceclang_1_1ento.html#a7b23a067324d14c5d493837dbc4fd8ca">SymbolRef</a>, StreamState)</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160; </div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="keyword">namespace </span>{</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="keyword">class </span>StopTrackingCallback final : <span class="keyword">public</span> SymbolVisitor {</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <a class="code" href="namespaceclang_1_1ento.html#a4e45a121820f0d80d8910093dd33a1df">ProgramStateRef</a> <a class="code" href="StaticAnalyzer_2README_8txt.html#a1a264b3e48bda8ea3bed83698db8dca7">state</a>;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  StopTrackingCallback(<a class="code" href="namespaceclang_1_1ento.html#a4e45a121820f0d80d8910093dd33a1df">ProgramStateRef</a> st) : <a class="code" href="StaticAnalyzer_2README_8txt.html#a1a264b3e48bda8ea3bed83698db8dca7">state</a>(<a class="code" href="namespacestd.html">std</a>::move(st)) {}</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <a class="code" href="namespaceclang_1_1ento.html#a4e45a121820f0d80d8910093dd33a1df">ProgramStateRef</a> getState()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="StaticAnalyzer_2README_8txt.html#a1a264b3e48bda8ea3bed83698db8dca7">state</a>; }</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160; </div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  <span class="keywordtype">bool</span> VisitSymbol(<a class="code" href="namespaceclang_1_1ento.html#a7b23a067324d14c5d493837dbc4fd8ca">SymbolRef</a> sym)<span class="keyword"> override </span>{</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <a class="code" href="StaticAnalyzer_2README_8txt.html#a1a264b3e48bda8ea3bed83698db8dca7">state</a> = <a class="code" href="StaticAnalyzer_2README_8txt.html#a1a264b3e48bda8ea3bed83698db8dca7">state</a>-&gt;remove&lt;StreamMap&gt;(sym);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  }</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;};</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;} <span class="comment">// end anonymous namespace</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160; </div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;SimpleStreamChecker::SimpleStreamChecker()</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    : OpenFn(<span class="stringliteral">&quot;fopen&quot;</span>), CloseFn(<span class="stringliteral">&quot;fclose&quot;</span>, 1) {</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <span class="comment">// Initialize the bug types.</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  DoubleCloseBugType.reset(</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;      <span class="keyword">new</span> BugType(<span class="keyword">this</span>, <span class="stringliteral">&quot;Double fclose&quot;</span>, <span class="stringliteral">&quot;Unix Stream API Error&quot;</span>));</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160; </div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  <span class="comment">// Sinks are higher importance bugs as well as calls to assert() or exit(0).</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  LeakBugType.reset(</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;      <span class="keyword">new</span> BugType(<span class="keyword">this</span>, <span class="stringliteral">&quot;Resource Leak&quot;</span>, <span class="stringliteral">&quot;Unix Stream API Error&quot;</span>,</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                  <span class="comment">/*SuppressOnSink=*/</span><span class="keyword">true</span>));</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;}</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160; </div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="keywordtype">void</span> SimpleStreamChecker::checkPostCall(<span class="keyword">const</span> CallEvent &amp;Call,</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                                        CheckerContext &amp;<a class="code" href="namespaceAttributeLangSupport.html#a2f895ae8ae6d7966390f197b109d1f4dac1c6ab9ca121c29c650b3ab6a4212b4e">C</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespaceclang_1_1index.html#a21cdcb5f0f9f26abf02e5c4c3bb93e11ac3755e61202abd74da5885d2e9c9160e">Call</a>.isGlobalCFunction())</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160; </div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <span class="keywordflow">if</span> (!OpenFn.matches(Call))</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160; </div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <span class="comment">// Get the symbolic value corresponding to the file handle.</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <a class="code" href="namespaceclang_1_1ento.html#a7b23a067324d14c5d493837dbc4fd8ca">SymbolRef</a> FileDesc = <a class="code" href="namespaceclang_1_1index.html#a21cdcb5f0f9f26abf02e5c4c3bb93e11ac3755e61202abd74da5885d2e9c9160e">Call</a>.getReturnValue().getAsSymbol();</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <span class="keywordflow">if</span> (!FileDesc)</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160; </div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="comment">// Generate the next transition (an edge in the exploded graph).</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  <a class="code" href="namespaceclang_1_1ento.html#a4e45a121820f0d80d8910093dd33a1df">ProgramStateRef</a> <a class="code" href="UnwrappedLineFormatter_8cpp.html#a83e9e4ff6cb05dbdf72ab2a01aa289c0">State</a> = <a class="code" href="namespaceAttributeLangSupport.html#a2f895ae8ae6d7966390f197b109d1f4dac1c6ab9ca121c29c650b3ab6a4212b4e">C</a>.getState();</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <a class="code" href="UnwrappedLineFormatter_8cpp.html#a83e9e4ff6cb05dbdf72ab2a01aa289c0">State</a> = <a class="code" href="UnwrappedLineFormatter_8cpp.html#a83e9e4ff6cb05dbdf72ab2a01aa289c0">State</a>-&gt;set&lt;StreamMap&gt;(FileDesc, StreamState::getOpened());</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <a class="code" href="namespaceAttributeLangSupport.html#a2f895ae8ae6d7966390f197b109d1f4dac1c6ab9ca121c29c650b3ab6a4212b4e">C</a>.addTransition(<a class="code" href="UnwrappedLineFormatter_8cpp.html#a83e9e4ff6cb05dbdf72ab2a01aa289c0">State</a>);</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;}</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160; </div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="keywordtype">void</span> SimpleStreamChecker::checkPreCall(<span class="keyword">const</span> CallEvent &amp;Call,</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                                       CheckerContext &amp;<a class="code" href="namespaceAttributeLangSupport.html#a2f895ae8ae6d7966390f197b109d1f4dac1c6ab9ca121c29c650b3ab6a4212b4e">C</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespaceclang_1_1index.html#a21cdcb5f0f9f26abf02e5c4c3bb93e11ac3755e61202abd74da5885d2e9c9160e">Call</a>.isGlobalCFunction())</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160; </div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  <span class="keywordflow">if</span> (!CloseFn.matches(Call))</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160; </div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="comment">// Get the symbolic value corresponding to the file handle.</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  <a class="code" href="namespaceclang_1_1ento.html#a7b23a067324d14c5d493837dbc4fd8ca">SymbolRef</a> FileDesc = <a class="code" href="namespaceclang_1_1index.html#a21cdcb5f0f9f26abf02e5c4c3bb93e11ac3755e61202abd74da5885d2e9c9160e">Call</a>.getArgSVal(0).getAsSymbol();</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  <span class="keywordflow">if</span> (!FileDesc)</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160; </div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  <span class="comment">// Check if the stream has already been closed.</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  <a class="code" href="namespaceclang_1_1ento.html#a4e45a121820f0d80d8910093dd33a1df">ProgramStateRef</a> <a class="code" href="UnwrappedLineFormatter_8cpp.html#a83e9e4ff6cb05dbdf72ab2a01aa289c0">State</a> = <a class="code" href="namespaceAttributeLangSupport.html#a2f895ae8ae6d7966390f197b109d1f4dac1c6ab9ca121c29c650b3ab6a4212b4e">C</a>.getState();</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  <span class="keyword">const</span> StreamState *SS = <a class="code" href="UnwrappedLineFormatter_8cpp.html#a83e9e4ff6cb05dbdf72ab2a01aa289c0">State</a>-&gt;get&lt;StreamMap&gt;(FileDesc);</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <span class="keywordflow">if</span> (SS &amp;&amp; SS-&gt;isClosed()) {</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    reportDoubleClose(FileDesc, Call, <a class="code" href="namespaceAttributeLangSupport.html#a2f895ae8ae6d7966390f197b109d1f4dac1c6ab9ca121c29c650b3ab6a4212b4e">C</a>);</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  }</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160; </div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  <span class="comment">// Generate the next transition, in which the stream is closed.</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  <a class="code" href="UnwrappedLineFormatter_8cpp.html#a83e9e4ff6cb05dbdf72ab2a01aa289c0">State</a> = <a class="code" href="UnwrappedLineFormatter_8cpp.html#a83e9e4ff6cb05dbdf72ab2a01aa289c0">State</a>-&gt;set&lt;StreamMap&gt;(FileDesc, StreamState::getClosed());</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <a class="code" href="namespaceAttributeLangSupport.html#a2f895ae8ae6d7966390f197b109d1f4dac1c6ab9ca121c29c650b3ab6a4212b4e">C</a>.addTransition(<a class="code" href="UnwrappedLineFormatter_8cpp.html#a83e9e4ff6cb05dbdf72ab2a01aa289c0">State</a>);</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;}</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160; </div>
<div class="line"><a name="l00163"></a><span class="lineno"><a class="line" href="SimpleStreamChecker_8cpp.html#ad0926d205b198ce2232116786e6aa587">  163</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimpleStreamChecker_8cpp.html#ad0926d205b198ce2232116786e6aa587">isLeaked</a>(<a class="code" href="namespaceclang_1_1ento.html#a7b23a067324d14c5d493837dbc4fd8ca">SymbolRef</a> Sym, <span class="keyword">const</span> StreamState &amp;SS,</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;                     <span class="keywordtype">bool</span> IsSymDead, <a class="code" href="namespaceclang_1_1ento.html#a4e45a121820f0d80d8910093dd33a1df">ProgramStateRef</a> <a class="code" href="UnwrappedLineFormatter_8cpp.html#a83e9e4ff6cb05dbdf72ab2a01aa289c0">State</a>) {</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <span class="keywordflow">if</span> (IsSymDead &amp;&amp; SS.isOpened()) {</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="comment">// If a symbol is NULL, assume that fopen failed on this path.</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="comment">// A symbol should only be considered leaked if it is non-null.</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    ConstraintManager &amp;CMgr = <a class="code" href="UnwrappedLineFormatter_8cpp.html#a83e9e4ff6cb05dbdf72ab2a01aa289c0">State</a>-&gt;getConstraintManager();</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    ConditionTruthVal OpenFailed = CMgr.isNull(<a class="code" href="UnwrappedLineFormatter_8cpp.html#a83e9e4ff6cb05dbdf72ab2a01aa289c0">State</a>, Sym);</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="keywordflow">return</span> !OpenFailed.isConstrainedTrue();</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  }</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;}</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160; </div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="keywordtype">void</span> SimpleStreamChecker::checkDeadSymbols(SymbolReaper &amp;SymReaper,</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                                           CheckerContext &amp;<a class="code" href="namespaceAttributeLangSupport.html#a2f895ae8ae6d7966390f197b109d1f4dac1c6ab9ca121c29c650b3ab6a4212b4e">C</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  <a class="code" href="namespaceclang_1_1ento.html#a4e45a121820f0d80d8910093dd33a1df">ProgramStateRef</a> <a class="code" href="UnwrappedLineFormatter_8cpp.html#a83e9e4ff6cb05dbdf72ab2a01aa289c0">State</a> = <a class="code" href="namespaceAttributeLangSupport.html#a2f895ae8ae6d7966390f197b109d1f4dac1c6ab9ca121c29c650b3ab6a4212b4e">C</a>.getState();</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  SymbolVector LeakedStreams;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  StreamMapTy TrackedStreams = <a class="code" href="UnwrappedLineFormatter_8cpp.html#a83e9e4ff6cb05dbdf72ab2a01aa289c0">State</a>-&gt;get&lt;StreamMap&gt;();</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  <span class="keywordflow">for</span> (StreamMapTy::iterator I = TrackedStreams.begin(),</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                             E = TrackedStreams.end(); I != E; ++I) {</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <a class="code" href="namespaceclang_1_1ento.html#a7b23a067324d14c5d493837dbc4fd8ca">SymbolRef</a> Sym = I-&gt;first;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="keywordtype">bool</span> IsSymDead = SymReaper.isDead(Sym);</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160; </div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="comment">// Collect leaked symbols.</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="SimpleStreamChecker_8cpp.html#ad0926d205b198ce2232116786e6aa587">isLeaked</a>(Sym, I-&gt;second, IsSymDead, <a class="code" href="UnwrappedLineFormatter_8cpp.html#a83e9e4ff6cb05dbdf72ab2a01aa289c0">State</a>))</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;      LeakedStreams.push_back(Sym);</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160; </div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="comment">// Remove the dead symbol from the streams map.</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="keywordflow">if</span> (IsSymDead)</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      <a class="code" href="UnwrappedLineFormatter_8cpp.html#a83e9e4ff6cb05dbdf72ab2a01aa289c0">State</a> = <a class="code" href="UnwrappedLineFormatter_8cpp.html#a83e9e4ff6cb05dbdf72ab2a01aa289c0">State</a>-&gt;remove&lt;StreamMap&gt;(Sym);</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  }</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160; </div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  ExplodedNode *N = <a class="code" href="namespaceAttributeLangSupport.html#a2f895ae8ae6d7966390f197b109d1f4dac1c6ab9ca121c29c650b3ab6a4212b4e">C</a>.generateNonFatalErrorNode(<a class="code" href="UnwrappedLineFormatter_8cpp.html#a83e9e4ff6cb05dbdf72ab2a01aa289c0">State</a>);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  <span class="keywordflow">if</span> (!N)</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  reportLeaks(LeakedStreams, <a class="code" href="namespaceAttributeLangSupport.html#a2f895ae8ae6d7966390f197b109d1f4dac1c6ab9ca121c29c650b3ab6a4212b4e">C</a>, N);</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;}</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160; </div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="keywordtype">void</span> SimpleStreamChecker::reportDoubleClose(<a class="code" href="namespaceclang_1_1ento.html#a7b23a067324d14c5d493837dbc4fd8ca">SymbolRef</a> FileDescSym,</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                                            <span class="keyword">const</span> CallEvent &amp;Call,</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                                            CheckerContext &amp;<a class="code" href="namespaceAttributeLangSupport.html#a2f895ae8ae6d7966390f197b109d1f4dac1c6ab9ca121c29c650b3ab6a4212b4e">C</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  <span class="comment">// We reached a bug, stop exploring the path here by generating a sink.</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  ExplodedNode *ErrNode = <a class="code" href="namespaceAttributeLangSupport.html#a2f895ae8ae6d7966390f197b109d1f4dac1c6ab9ca121c29c650b3ab6a4212b4e">C</a>.generateErrorNode();</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <span class="comment">// If we&#39;ve already reached this node on another path, return.</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  <span class="keywordflow">if</span> (!ErrNode)</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160; </div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  <span class="comment">// Generate the report.</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  <span class="keyword">auto</span> R = std::make_unique&lt;PathSensitiveBugReport&gt;(</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      *DoubleCloseBugType, <span class="stringliteral">&quot;Closing a previously closed file stream&quot;</span>, ErrNode);</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  R-&gt;addRange(<a class="code" href="namespaceclang_1_1index.html#a21cdcb5f0f9f26abf02e5c4c3bb93e11ac3755e61202abd74da5885d2e9c9160e">Call</a>.getSourceRange());</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  R-&gt;markInteresting(FileDescSym);</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  <a class="code" href="namespaceAttributeLangSupport.html#a2f895ae8ae6d7966390f197b109d1f4dac1c6ab9ca121c29c650b3ab6a4212b4e">C</a>.emitReport(std::move(R));</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;}</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160; </div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="keywordtype">void</span> SimpleStreamChecker::reportLeaks(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;SymbolRef&gt;</a> LeakedStreams,</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                                      CheckerContext &amp;<a class="code" href="namespaceAttributeLangSupport.html#a2f895ae8ae6d7966390f197b109d1f4dac1c6ab9ca121c29c650b3ab6a4212b4e">C</a>,</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                                      ExplodedNode *ErrNode)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  <span class="comment">// Attach bug reports to the leak node.</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  <span class="comment">// TODO: Identify the leaked file descriptor.</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespaceclang_1_1ento.html#a7b23a067324d14c5d493837dbc4fd8ca">SymbolRef</a> LeakedStream : LeakedStreams) {</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="keyword">auto</span> R = std::make_unique&lt;PathSensitiveBugReport&gt;(</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        *LeakBugType, <span class="stringliteral">&quot;Opened file is never closed; potential resource leak&quot;</span>,</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        ErrNode);</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    R-&gt;markInteresting(LeakedStream);</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <a class="code" href="namespaceAttributeLangSupport.html#a2f895ae8ae6d7966390f197b109d1f4dac1c6ab9ca121c29c650b3ab6a4212b4e">C</a>.emitReport(std::move(R));</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  }</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;}</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160; </div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="keywordtype">bool</span> SimpleStreamChecker::guaranteedNotToCloseFile(<span class="keyword">const</span> CallEvent &amp;Call)<span class="keyword"> const</span>{</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  <span class="comment">// If it&#39;s not in a system header, assume it might close a file.</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespaceclang_1_1index.html#a21cdcb5f0f9f26abf02e5c4c3bb93e11ac3755e61202abd74da5885d2e9c9160e">Call</a>.isInSystemHeader())</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160; </div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  <span class="comment">// Handle cases where we know a buffer&#39;s /address/ can escape.</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespaceclang_1_1index.html#a21cdcb5f0f9f26abf02e5c4c3bb93e11ac3755e61202abd74da5885d2e9c9160e">Call</a>.argumentsMayEscape())</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160; </div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  <span class="comment">// Note, even though fclose closes the file, we do not list it here</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  <span class="comment">// since the checker is modeling the call.</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160; </div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;}</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160; </div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment">// If the pointer we are tracking escaped, do not track the symbol as</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="comment">// we cannot reason about it anymore.</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<a class="code" href="namespaceclang_1_1ento.html#a4e45a121820f0d80d8910093dd33a1df">ProgramStateRef</a></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;SimpleStreamChecker::checkPointerEscape(<a class="code" href="namespaceclang_1_1ento.html#a4e45a121820f0d80d8910093dd33a1df">ProgramStateRef</a> <a class="code" href="UnwrappedLineFormatter_8cpp.html#a83e9e4ff6cb05dbdf72ab2a01aa289c0">State</a>,</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                                        <span class="keyword">const</span> <a class="code" href="namespaceclang_1_1ento.html#ab2743eb22efec4f33d5138cfb12366d6">InvalidatedSymbols</a> &amp;Escaped,</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                                        <span class="keyword">const</span> CallEvent *Call,</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                                        <a class="code" href="namespaceclang_1_1ento.html#a1f45158b71c9d04bfd6094ee29a38e59">PointerEscapeKind</a> <a class="code" href="namespaceclang_1_1ObjCPropertyAttribute.html#a5cee046f95725089d626e8e3c42bf60c">Kind</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  <span class="comment">// If we know that the call cannot close a file, there is nothing to do.</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespaceclang_1_1ObjCPropertyAttribute.html#a5cee046f95725089d626e8e3c42bf60c">Kind</a> == <a class="code" href="namespaceclang_1_1ento.html#a1f45158b71c9d04bfd6094ee29a38e59a1c38c1cbdb7ff99b102f29a5f8453f4d">PSK_DirectEscapeOnCall</a> &amp;&amp; guaranteedNotToCloseFile(*Call)) {</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="UnwrappedLineFormatter_8cpp.html#a83e9e4ff6cb05dbdf72ab2a01aa289c0">State</a>;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  }</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160; </div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  <span class="keywordflow">for</span> (InvalidatedSymbols::const_iterator I = Escaped.begin(),</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                                          E = Escaped.end();</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                                          I != E; ++I) {</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <a class="code" href="namespaceclang_1_1ento.html#a7b23a067324d14c5d493837dbc4fd8ca">SymbolRef</a> Sym = *I;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160; </div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="comment">// The symbol escaped. Optimistically, assume that the corresponding file</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="comment">// handle will be closed somewhere else.</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <a class="code" href="UnwrappedLineFormatter_8cpp.html#a83e9e4ff6cb05dbdf72ab2a01aa289c0">State</a> = <a class="code" href="UnwrappedLineFormatter_8cpp.html#a83e9e4ff6cb05dbdf72ab2a01aa289c0">State</a>-&gt;remove&lt;StreamMap&gt;(Sym);</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  }</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="UnwrappedLineFormatter_8cpp.html#a83e9e4ff6cb05dbdf72ab2a01aa289c0">State</a>;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;}</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160; </div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="keywordtype">void</span> ento::registerSimpleStreamChecker(CheckerManager &amp;mgr) {</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  mgr.registerChecker&lt;SimpleStreamChecker&gt;();</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;}</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160; </div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment">// This checker should be enabled regardless of how language options are set.</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="keywordtype">bool</span> ento::shouldRegisterSimpleStreamChecker(<span class="keyword">const</span> CheckerManager &amp;mgr) {</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="anamespaceclang_1_1ento_html_a1f45158b71c9d04bfd6094ee29a38e59a1c38c1cbdb7ff99b102f29a5f8453f4d"><div class="ttname"><a href="namespaceclang_1_1ento.html#a1f45158b71c9d04bfd6094ee29a38e59a1c38c1cbdb7ff99b102f29a5f8453f4d">clang::ento::PSK_DirectEscapeOnCall</a></div><div class="ttdeci">@ PSK_DirectEscapeOnCall</div><div class="ttdoc">The pointer has been passed to a function call directly.</div><div class="ttdef"><b>Definition:</b> <a href="CheckerManager_8h_source.html#l00084">CheckerManager.h:84</a></div></div>
<div class="ttc" id="aSimpleStreamChecker_8cpp_html_ad0926d205b198ce2232116786e6aa587"><div class="ttname"><a href="SimpleStreamChecker_8cpp.html#ad0926d205b198ce2232116786e6aa587">isLeaked</a></div><div class="ttdeci">static bool isLeaked(SymbolRef Sym, const StreamState &amp;SS, bool IsSymDead, ProgramStateRef State)</div><div class="ttdef"><b>Definition:</b> <a href="SimpleStreamChecker_8cpp_source.html#l00163">SimpleStreamChecker.cpp:163</a></div></div>
<div class="ttc" id="aCallDescription_8h_html"><div class="ttname"><a href="CallDescription_8h.html">CallDescription.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVector_html"><div class="ttname"><a href="classllvm_1_1SmallVector.html">llvm::SmallVector</a></div><div class="ttdef"><b>Definition:</b> <a href="LLVM_8h_source.html#l00038">LLVM.h:38</a></div></div>
<div class="ttc" id="anamespaceclang_1_1ento_html_a4e45a121820f0d80d8910093dd33a1df"><div class="ttname"><a href="namespaceclang_1_1ento.html#a4e45a121820f0d80d8910093dd33a1df">clang::ento::ProgramStateRef</a></div><div class="ttdeci">IntrusiveRefCntPtr&lt; const ProgramState &gt; ProgramStateRef</div><div class="ttdef"><b>Definition:</b> <a href="ProgramState__Fwd_8h_source.html#l00037">ProgramState_Fwd.h:37</a></div></div>
<div class="ttc" id="anamespaceAttributeLangSupport_html_a2f895ae8ae6d7966390f197b109d1f4dac1c6ab9ca121c29c650b3ab6a4212b4e"><div class="ttname"><a href="namespaceAttributeLangSupport.html#a2f895ae8ae6d7966390f197b109d1f4dac1c6ab9ca121c29c650b3ab6a4212b4e">AttributeLangSupport::C</a></div><div class="ttdeci">@ C</div><div class="ttdef"><b>Definition:</b> <a href="SemaDeclAttr_8cpp_source.html#l00054">SemaDeclAttr.cpp:54</a></div></div>
<div class="ttc" id="anamespaceclang_1_1api__notes_html_a9b6b1e81948c2ed6b68a07a017c07673a03f4a47830f97377a35321051685071e"><div class="ttname"><a href="namespaceclang_1_1api__notes.html#a9b6b1e81948c2ed6b68a07a017c07673a03f4a47830f97377a35321051685071e">clang::api_notes::EnumExtensibilityKind::Closed</a></div><div class="ttdeci">@ Closed</div></div>
<div class="ttc" id="anamespaceclang_1_1ento_html_a7b23a067324d14c5d493837dbc4fd8ca"><div class="ttname"><a href="namespaceclang_1_1ento.html#a7b23a067324d14c5d493837dbc4fd8ca">clang::ento::SymbolRef</a></div><div class="ttdeci">const SymExpr * SymbolRef</div><div class="ttdef"><b>Definition:</b> <a href="SymExpr_8h_source.html#l00110">SymExpr.h:110</a></div></div>
<div class="ttc" id="anamespaceclang_1_1tooling_html_a4ffee664435dba78b2225a5457619b53"><div class="ttname"><a href="namespaceclang_1_1tooling.html#a4ffee664435dba78b2225a5457619b53">clang::tooling::X</a></div><div class="ttdeci">static ToolExecutorPluginRegistry::Add&lt; AllTUsToolExecutorPlugin &gt; X(&quot;all-TUs&quot;, &quot;Runs FrontendActions on all TUs in the compilation database. &quot; &quot;Tool results are stored in memory.&quot;)</div></div>
<div class="ttc" id="anamespaceclang_1_1index_html_a21cdcb5f0f9f26abf02e5c4c3bb93e11ac3755e61202abd74da5885d2e9c9160e"><div class="ttname"><a href="namespaceclang_1_1index.html#a21cdcb5f0f9f26abf02e5c4c3bb93e11ac3755e61202abd74da5885d2e9c9160e">clang::index::SymbolRole::Call</a></div><div class="ttdeci">@ Call</div></div>
<div class="ttc" id="aCallEvent_8h_html"><div class="ttname"><a href="CallEvent_8h.html">CallEvent.h</a></div></div>
<div class="ttc" id="aProgramStateTrait_8h_html_a6d1893bb8c18543337b6c363c1319fcf"><div class="ttname"><a href="ProgramStateTrait_8h.html#a6d1893bb8c18543337b6c363c1319fcf">REGISTER_MAP_WITH_PROGRAMSTATE</a></div><div class="ttdeci">#define REGISTER_MAP_WITH_PROGRAMSTATE(Name, Key, Value)</div><div class="ttdoc">Declares an immutable map of type NameTy, suitable for placement into the ProgramState.</div><div class="ttdef"><b>Definition:</b> <a href="ProgramStateTrait_8h_source.html#l00084">ProgramStateTrait.h:84</a></div></div>
<div class="ttc" id="aBuiltinCheckerRegistration_8h_html"><div class="ttname"><a href="BuiltinCheckerRegistration_8h.html">BuiltinCheckerRegistration.h</a></div></div>
<div class="ttc" id="aStaticAnalyzer_2README_8txt_html_a1a264b3e48bda8ea3bed83698db8dca7"><div class="ttname"><a href="StaticAnalyzer_2README_8txt.html#a1a264b3e48bda8ea3bed83698db8dca7">state</a></div><div class="ttdeci">and static some checkers Checker The latter are built on top of the former via the Checker and CheckerVisitor and attempts to isolate them from much of the gore of the internal analysis the analyzer is basically a source code simulator that traces out possible paths of execution The state of the and the combination of state and program point is a node in an exploded which has the entry program point and initial state</div><div class="ttdef"><b>Definition:</b> <a href="StaticAnalyzer_2README_8txt_source.html#l00030">README.txt:30</a></div></div>
<div class="ttc" id="aBugType_8h_html"><div class="ttname"><a href="BugType_8h.html">BugType.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1ArrayRef_html"><div class="ttname"><a href="classllvm_1_1ArrayRef.html">llvm::ArrayRef</a></div><div class="ttdef"><b>Definition:</b> <a href="LLVM_8h_source.html#l00034">LLVM.h:34</a></div></div>
<div class="ttc" id="aUnwrappedLineFormatter_8cpp_html_a83e9e4ff6cb05dbdf72ab2a01aa289c0"><div class="ttname"><a href="UnwrappedLineFormatter_8cpp.html#a83e9e4ff6cb05dbdf72ab2a01aa289c0">State</a></div><div class="ttdeci">LineState State</div><div class="ttdef"><b>Definition:</b> <a href="UnwrappedLineFormatter_8cpp_source.html#l01083">UnwrappedLineFormatter.cpp:1083</a></div></div>
<div class="ttc" id="aCheckerContext_8h_html"><div class="ttname"><a href="CheckerContext_8h.html">CheckerContext.h</a></div></div>
<div class="ttc" id="anamespaceclang_1_1ObjCPropertyAttribute_html_a5cee046f95725089d626e8e3c42bf60c"><div class="ttname"><a href="namespaceclang_1_1ObjCPropertyAttribute.html#a5cee046f95725089d626e8e3c42bf60c">clang::ObjCPropertyAttribute::Kind</a></div><div class="ttdeci">Kind</div><div class="ttdef"><b>Definition:</b> <a href="DeclObjCCommon_8h_source.html#l00022">DeclObjCCommon.h:22</a></div></div>
<div class="ttc" id="aChecker_8h_html"><div class="ttname"><a href="Checker_8h.html">Checker.h</a></div></div>
<div class="ttc" id="anamespacestd_html"><div class="ttname"><a href="namespacestd.html">std</a></div><div class="ttdef"><b>Definition:</b> <a href="Format_8h_source.html#l04296">Format.h:4296</a></div></div>
<div class="ttc" id="anamespaceclang_1_1Builtin_html_a96281da348e2b70f3a45a66f6e48905c"><div class="ttname"><a href="namespaceclang_1_1Builtin.html#a96281da348e2b70f3a45a66f6e48905c">clang::Builtin::ID</a></div><div class="ttdeci">ID</div><div class="ttdef"><b>Definition:</b> <a href="Builtins_8h_source.html#l00049">Builtins.h:49</a></div></div>
<div class="ttc" id="anamespaceclang_html"><div class="ttname"><a href="namespaceclang.html">clang</a></div><div class="ttdef"><b>Definition:</b> <a href="CalledOnceCheck_8h_source.html#l00017">CalledOnceCheck.h:17</a></div></div>
<div class="ttc" id="anamespaceclang_1_1ento_html_a1f45158b71c9d04bfd6094ee29a38e59"><div class="ttname"><a href="namespaceclang_1_1ento.html#a1f45158b71c9d04bfd6094ee29a38e59">clang::ento::PointerEscapeKind</a></div><div class="ttdeci">PointerEscapeKind</div><div class="ttdoc">Describes the different reasons a pointer escapes during analysis.</div><div class="ttdef"><b>Definition:</b> <a href="CheckerManager_8h_source.html#l00078">CheckerManager.h:78</a></div></div>
<div class="ttc" id="anamespaceclang_1_1ento_html_ab2743eb22efec4f33d5138cfb12366d6"><div class="ttname"><a href="namespaceclang_1_1ento.html#ab2743eb22efec4f33d5138cfb12366d6">clang::ento::InvalidatedSymbols</a></div><div class="ttdeci">llvm::DenseSet&lt; SymbolRef &gt; InvalidatedSymbols</div><div class="ttdef"><b>Definition:</b> <a href="Store_8h_source.html#l00051">Store.h:51</a></div></div>
<div class="ttc" id="anamespaceclang_html_a4a57f21b55a81cefae4379e09a3be0c3"><div class="ttname"><a href="namespaceclang.html#a4a57f21b55a81cefae4379e09a3be0c3">clang::operator==</a></div><div class="ttdeci">bool operator==(const CallGraphNode::CallRecord &amp;LHS, const CallGraphNode::CallRecord &amp;RHS)</div><div class="ttdef"><b>Definition:</b> <a href="CallGraph_8h_source.html#l00223">CallGraph.h:223</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Apr 4 2022 01:35:53 for clang by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
