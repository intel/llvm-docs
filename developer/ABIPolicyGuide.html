<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>ABI Policy Guide &#8212; oneAPI DPC++ Compiler  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=649a27d8" />
    <link rel="stylesheet" type="text/css" href="../_static/haiku.css?v=e491ac2d" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Contributing to DPC++" href="ContributeToDPCPP.html" />
    <link rel="prev" title="Docker Containers BKMs" href="DockerBKMs.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="../index.html">
          <span>oneAPI DPC++ Compiler  documentation</span></a></h1>
        <h2 class="heading"><span>ABI Policy Guide</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="DockerBKMs.html">Docker Containers BKMs</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="ContributeToDPCPP.html">Contributing to DPC++</a>&#160;&#160;»
        </p>

      </div>
      <div class="content" role="main">
        
        
  <section id="abi-policy-guide">
<h1>ABI Policy Guide<a class="headerlink" href="#abi-policy-guide" title="Link to this heading">¶</a></h1>
<section id="intro">
<h2>Intro<a class="headerlink" href="#intro" title="Link to this heading">¶</a></h2>
<p>Application Binary Interface is a contract between binary modules, that defines
how structures and routines are accessed in machine code. Changing the ABI may
break backwards compatibility of user application with the DPC++ runtime library
for user-developed applications, resulting in need to rebuild such applications.
The goal of this document is to provide guidelines for maintaining the current
ABI of the DPC++ runtime library and mechanisms of notifying users about ABI
changes.</p>
<p>All ABI changes can be divided into two large groups: breaking and non-breaking.
A breaking change means that the new binary is incompatible with the previous
version (i.e. it can not be used as a drop-in replacement). A non-breaking
change means that the forward compatibility is broken (i.e. the old library
can be replaced with newer version, but not vice versa).</p>
<p>The following non-exhaustive list contains changes that are considered to be
breaking:</p>
<ol class="arabic simple">
<li><p>Changing the size of exported symbol (for example, adding new member field
to the exported class).</p></li>
<li><p>Removing the exported symbol (that includes both changing the signature of
exported routine and removing it).</p></li>
<li><p>Changing the alignment of exported symbol.</p></li>
<li><p>Changing the layout of exported symbol (for example, reordering class field
members).</p></li>
<li><p>Adding or removing base classes.</p></li>
</ol>
<p>Adding a new exported symbol is considered to be non-breaking change.</p>
</section>
<section id="abi-versioning-policy">
<h2>ABI Versioning Policy<a class="headerlink" href="#abi-versioning-policy" title="Link to this heading">¶</a></h2>
<p>The release version of the DPC++ runtime library follows
<a class="reference external" href="https://semver.org/">Semantic Versioning</a> scheme: <code class="docutils literal notranslate"><span class="pre">MAJOR.MINOR.PATCH</span></code>. <code class="docutils literal notranslate"><span class="pre">MAJOR</span></code>
version indicates breaking change. Version <code class="docutils literal notranslate"><span class="pre">X</span></code> is backwards incompatible with
version <code class="docutils literal notranslate"><span class="pre">X-1</span></code>. <code class="docutils literal notranslate"><span class="pre">MINOR</span></code> indicates a non-breaking change. We bump the versions
immediately after the previous release had been branched off. As such, if next
release is allowed/expected to be ABI-breaking we bump <code class="docutils literal notranslate"><span class="pre">MAJOR</span></code> and drop <code class="docutils literal notranslate"><span class="pre">MINOR</span></code>
to zero otherwise increment <code class="docutils literal notranslate"><span class="pre">MINOR</span></code> in the beginning of the development cycles.</p>
</section>
<section id="sycl-export-macro">
<h2><code class="docutils literal notranslate"><span class="pre">__SYCL_EXPORT</span></code> Macro<a class="headerlink" href="#sycl-export-macro" title="Link to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">__SYCL_EXPORT</span></code> provides facilities for fine-grained control over exported
symbols. Mark symbols that are supposed to be accessible by the user and that
are implemented in the SYCL Runtime library with this macro. Template
specializations also must be explicitly marked with <code class="docutils literal notranslate"><span class="pre">__SYCL_EXPORT</span></code> macro.
Symbols not marked <code class="docutils literal notranslate"><span class="pre">__SYCL_EXPORT</span></code> have internal linkage.</p>
<p>A few examples of when it is necessary to mark symbols with the macro:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">device</span></code> class:</p>
<ul>
<li><p>It is defined as API by the SYCL spec.</p></li>
<li><p>It is implemented in <code class="docutils literal notranslate"><span class="pre">device.cpp</span></code> file.</p></li>
</ul>
</li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">SYCLMemObjT</span></code> class:</p>
<ul>
<li><p>It is not defined in the SYCL spec, but it is an implementation detail that
is accessible by the user (buffer and image inherit from this class).</p></li>
<li><p>It has symbols that are implemented in the Runtime library.</p></li>
</ul>
</li>
</ul>
<p>When it is not necessary to mark symbols with <code class="docutils literal notranslate"><span class="pre">__SYCL_EXPORT</span></code>:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">buffer</span></code> class:</p>
<ul>
<li><p>It is defined by the SYCL spec, but it is fully implemented in the headers.</p></li>
</ul>
</li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">ProgramManager</span></code> class:</p>
<ul>
<li><p>It is an implementation detail.</p></li>
<li><p>It is not accessed from the header files that are available to users.</p></li>
</ul>
</li>
</ul>
</section>
<section id="automated-abi-changes-testing">
<h2>Automated ABI Changes Testing<a class="headerlink" href="#automated-abi-changes-testing" title="Link to this heading">¶</a></h2>
<blockquote>
<div><p>The automated tests deal with the most commonly occurring problems, but they
may not catch some corner cases. If you believe your PR breaks ABI, but the
test does not indicate that, please, notify the reviewers.</p>
</div></blockquote>
<p>There is a set of tests to help identifying ABI changes:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">test/abi/sycl_symbols_*.dump</span></code> contains dump of publicly available symbols.
If you add a new symbol, it is considered non-breaking change. When the test
reports missing symbols, it means you have either changed or remove some of
existing API methods. In both cases you need to adjust the dump file. You
can do it either manually, or by invoking the following command:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>sycl/tools/abi_check.py<span class="w"> </span>--mode<span class="w"> </span>dump_symbols<span class="w"> </span>--output<span class="w"> </span>path/to/output.dump<span class="w"> </span>path/to/sycl.so<span class="o">(</span>.dll<span class="o">)</span>
</pre></div>
</div>
<p>Please, prefer updating the test files with the above command. The checker
script automatically sorts symbols. This would allow developers to avoid
large diffs and help maintainers identify the nature of ABI changes.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">test/abi/layout*</span></code> and <code class="docutils literal notranslate"><span class="pre">test/abi/symbol_size_alignment.cpp</span></code> are a group of
tests to check the internal layout of some classes. The <code class="docutils literal notranslate"><span class="pre">layout*</span></code> tests check
some of API classes for layout changes, while <code class="docutils literal notranslate"><span class="pre">symbol_size_alignment</span></code> only
checks <code class="docutils literal notranslate"><span class="pre">sizeof</span></code> and <code class="docutils literal notranslate"><span class="pre">alignof</span></code> for API classes. Changing the class layout is a
breaking change.</p></li>
</ul>
</section>
<section id="changing-abi">
<h2>Changing ABI<a class="headerlink" href="#changing-abi" title="Link to this heading">¶</a></h2>
<p>Generally DPC++ runtime and compiler ABI is frozen and ABI-breaking changes are
not accepted by default since Oct 2020. Please try to avoid making any breaking
changes. If you need to change existing functionality, consider adding new APIs
instead of replacing existing APIs. Also, please, avoid any changes, mentioned in the
<a class="reference internal" href="#intro">Intro</a> section as breaking. Refer to the above guide to distinguish
between breaking and non-breaking changes. If unsure, do not hesitate to ask code
owners for help.</p>
<p><strong>Note</strong>: Features clearly marked as experimental are considered as an exception
to this guideline.</p>
<section id="abi-breaking-changes-window-april-18-july-11-2023-closed">
<h3>ABI breaking changes window April 18 - July 11 2023 [CLOSED]<a class="headerlink" href="#abi-breaking-changes-window-april-18-july-11-2023-closed" title="Link to this heading">¶</a></h3>
<p>Next ABI breaking changes window is tenatively April 2024.</p>
</section>
</section>
</section>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="DockerBKMs.html">Docker Containers BKMs</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="ContributeToDPCPP.html">Contributing to DPC++</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
    &#169; Copyright 2024, Intel Corporation.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
  </body>
</html>