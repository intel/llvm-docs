<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>RealtimeSanitizer &#8212; Clang 20.0.0git documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=649a27d8" />
    <link rel="stylesheet" type="text/css" href="_static/haiku.css?v=dfa0e015" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=fd3f3429" />
    <script src="_static/documentation_options.js?v=5cbea708"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="SanitizerCoverage" href="SanitizerCoverage.html" />
    <link rel="prev" title="LeakSanitizer" href="LeakSanitizer.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="index.html">
          <span>Clang 20.0.0git documentation</span></a></h1>
        <h2 class="heading"><span>RealtimeSanitizer</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="LeakSanitizer.html">LeakSanitizer</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="SanitizerCoverage.html">SanitizerCoverage</a>&#160;&#160;»
        </p>

      </div>
      <div class="content" role="main">
        
        
  <section id="realtimesanitizer">
<h1>RealtimeSanitizer<a class="headerlink" href="#realtimesanitizer" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#introduction" id="id1">Introduction</a></p></li>
<li><p><a class="reference internal" href="#how-to-build" id="id2">How to build</a></p></li>
<li><p><a class="reference internal" href="#usage" id="id3">Usage</a></p></li>
</ul>
</nav>
<section id="introduction">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Introduction</a><a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h2>
<p>RealtimeSanitizer (a.k.a. RTSan) is a real-time safety testing tool for C and C++
projects. RTSan can be used to detect real-time violations, i.e. calls to methods
that are not safe for use in functions with deterministic runtime requirements.
RTSan considers any function marked with the <code class="docutils literal notranslate"><span class="pre">[[clang::nonblocking]]</span></code> attribute
to be a real-time function. If RTSan detects a call to <code class="docutils literal notranslate"><span class="pre">malloc</span></code>, <code class="docutils literal notranslate"><span class="pre">free</span></code>,
<code class="docutils literal notranslate"><span class="pre">pthread_mutex_lock</span></code>, or anything else that could have a non-deterministic
execution time in a function marked <code class="docutils literal notranslate"><span class="pre">[[clang::nonblocking]]</span></code>
RTSan raises an error.</p>
<p>The runtime slowdown introduced by RealtimeSanitizer is negligible.</p>
</section>
<section id="how-to-build">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">How to build</a><a class="headerlink" href="#how-to-build" title="Link to this heading">¶</a></h2>
<p>Build LLVM/Clang with <cite>CMake &lt;https://llvm.org/docs/CMake.html&gt;</cite> and enable the
<code class="docutils literal notranslate"><span class="pre">compiler-rt</span></code> runtime. An example CMake configuration that will allow for the
use/testing of RealtimeSanitizer:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cmake<span class="w"> </span>-DCMAKE_BUILD_TYPE<span class="o">=</span>Release<span class="w"> </span>-DLLVM_ENABLE_PROJECTS<span class="o">=</span><span class="s2">&quot;clang&quot;</span><span class="w"> </span>-DLLVM_ENABLE_RUNTIMES<span class="o">=</span><span class="s2">&quot;compiler-rt&quot;</span><span class="w"> </span>&lt;path<span class="w"> </span>to<span class="w"> </span>source&gt;/llvm
</pre></div>
</div>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Link to this heading">¶</a></h2>
<p>There are two requirements:</p>
<ol class="arabic simple">
<li><p>The code must be compiled with the <code class="docutils literal notranslate"><span class="pre">-fsanitize=realtime</span></code> flag.</p></li>
<li><p>Functions that are subject to real-time constraints must be marked
with the <code class="docutils literal notranslate"><span class="pre">[[clang::nonblocking]]</span></code> attribute.</p></li>
</ol>
<p>Typically, these attributes should be added onto the functions that are entry
points for threads with real-time priority. These threads are subject to a fixed
callback time, such as audio callback threads or rendering loops in video game
code.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">% </span>cat<span class="w"> </span>example_realtime_violation.cpp
<span class="gp">#</span>include<span class="w"> </span>&lt;vector&gt;

<span class="go">void violation() [[clang::nonblocking]]{</span>
<span class="go">  std::vector&lt;float&gt; v;</span>
<span class="go">  v.resize(100);</span>
<span class="go">}</span>

<span class="go">int main() {</span>
<span class="go">  violation();</span>
<span class="go">  return 0;</span>
<span class="go">}</span>
<span class="gp"># </span>Compile<span class="w"> </span>and<span class="w"> </span>link
<span class="gp">% </span>clang++<span class="w"> </span>-fsanitize<span class="o">=</span>realtime<span class="w"> </span>-g<span class="w"> </span>example_realtime_violation.cpp
</pre></div>
</div>
<p>If a real-time safety violation is detected in a <code class="docutils literal notranslate"><span class="pre">[[clang::nonblocking]]</span></code>
context, or any function invoked by that function, the program will exit with a
non-zero exit code.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">% </span>clang++<span class="w"> </span>-fsanitize<span class="o">=</span>realtime<span class="w"> </span>-g<span class="w"> </span>example_realtime_violation.cpp
<span class="gp">% </span>./a.out
<span class="go">Real-time violation: intercepted call to real-time unsafe function `malloc` in real-time context! Stack trace:</span>
<span class="gp"> #</span><span class="m">0</span><span class="w"> </span>0x000102893034<span class="w"> </span><span class="k">in</span><span class="w"> </span>__rtsan::PrintStackTrace<span class="o">()</span><span class="w"> </span>rtsan_stack.cpp:45
<span class="gp"> #</span><span class="m">1</span><span class="w"> </span>0x000102892e64<span class="w"> </span><span class="k">in</span><span class="w"> </span>__rtsan::Context::ExpectNotRealtime<span class="o">(</span>char<span class="w"> </span>const*<span class="o">)</span><span class="w"> </span>rtsan_context.cpp:78
<span class="gp"> #</span><span class="m">2</span><span class="w"> </span>0x00010289397c<span class="w"> </span><span class="k">in</span><span class="w"> </span>malloc<span class="w"> </span>rtsan_interceptors.cpp:286
<span class="gp"> #</span><span class="m">3</span><span class="w"> </span>0x000195bd7bd0<span class="w"> </span><span class="k">in</span><span class="w"> </span>operator<span class="w"> </span>new<span class="o">(</span>unsigned<span class="w"> </span>long<span class="o">)</span>+0x1c<span class="w"> </span><span class="o">(</span>libc++abi.dylib:arm64+0x16bd0<span class="o">)</span>
<span class="gp"> #</span><span class="m">4</span><span class="w"> </span>0x5c7f00010230f07c<span class="w">  </span><span class="o">(</span>&lt;unknown<span class="w"> </span>module&gt;<span class="o">)</span>
<span class="gp"> #</span><span class="m">5</span><span class="w"> </span>0x00010230f058<span class="w"> </span><span class="k">in</span><span class="w"> </span>std::__1::__libcpp_allocate<span class="o">[</span>abi:ue170006<span class="o">](</span>unsigned<span class="w"> </span>long,<span class="w"> </span>unsigned<span class="w"> </span>long<span class="o">)</span><span class="w"> </span>new:324
<span class="gp"> #</span><span class="m">6</span><span class="w"> </span>0x00010230effc<span class="w"> </span><span class="k">in</span><span class="w"> </span>std::__1::allocator&lt;float&gt;::allocate<span class="o">[</span>abi:ue170006<span class="o">](</span>unsigned<span class="w"> </span>long<span class="o">)</span><span class="w"> </span>allocator.h:114
<span class="go"> ... snip ...</span>
<span class="gp"> #</span><span class="m">10</span><span class="w"> </span>0x00010230e4bc<span class="w"> </span><span class="k">in</span><span class="w"> </span>std::__1::vector&lt;float,<span class="w"> </span>std::__1::allocator&lt;float&gt;&gt;::__append<span class="o">(</span>unsigned<span class="w"> </span>long<span class="o">)</span><span class="w"> </span>vector:1162
<span class="gp"> #</span><span class="m">11</span><span class="w"> </span>0x00010230dcdc<span class="w"> </span><span class="k">in</span><span class="w"> </span>std::__1::vector&lt;float,<span class="w"> </span>std::__1::allocator&lt;float&gt;&gt;::resize<span class="o">(</span>unsigned<span class="w"> </span>long<span class="o">)</span><span class="w"> </span>vector:1981
<span class="gp"> #</span><span class="m">12</span><span class="w"> </span>0x00010230dc28<span class="w"> </span><span class="k">in</span><span class="w"> </span>violation<span class="o">()</span><span class="w"> </span>main.cpp:5
<span class="gp"> #</span><span class="m">13</span><span class="w"> </span>0x00010230dd64<span class="w"> </span><span class="k">in</span><span class="w"> </span>main<span class="w"> </span>main.cpp:9
<span class="gp"> #</span><span class="m">14</span><span class="w"> </span>0x0001958960dc<span class="w">  </span><span class="o">(</span>&lt;unknown<span class="w"> </span>module&gt;<span class="o">)</span>
<span class="gp"> #</span><span class="m">15</span><span class="w"> </span>0x2f557ffffffffffc<span class="w">  </span><span class="o">(</span>&lt;unknown<span class="w"> </span>module&gt;<span class="o">)</span>
</pre></div>
</div>
</section>
</section>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="LeakSanitizer.html">LeakSanitizer</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="SanitizerCoverage.html">SanitizerCoverage</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
    &#169; Copyright 2007-2024, The Clang Team.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.3.7.
    </div>
  </body>
</html>